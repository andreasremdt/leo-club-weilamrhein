---
import type { PaginateFunction } from "astro";
import PostPreview from "components/post-preview.astro";
import Button from "components/button.astro";
import PageLayout from "layouts/page-layout.astro";
import CategorySelector from "components/category-selector.astro";
import { getPostExcerpt, getPostThumbnail } from "lib/helpers";

export async function getStaticPaths({ paginate }: { paginate: PaginateFunction }) {
  const posts = (await Astro.glob("./**/*.md")).sort(
    (a, b) => new Date(b.frontmatter.date).valueOf() - new Date(a.frontmatter.date).valueOf()
  );

  return paginate(posts, { pageSize: 10 });
}

function getPageTitle(page: number) {
  if (page === 1) return "";

  return ` - Seite ${page}`;
}

const { page } = Astro.props;
---

<PageLayout
  title={`Unsere Aktionen ${getPageTitle(page.currentPage)}`}
  description="Erfahren Sie mehr über unsere zahlreichen Aktionen in Deutschland, Frankreich und der Schweiz."
>
  <main>
    <CategorySelector />

    {
      page.data.map((post: any) => (
        <PostPreview
          title={post.frontmatter.title}
          date={post.frontmatter.date}
          url={post.url as string}
          thumbnail={getPostThumbnail(post)}
          excerpt={getPostExcerpt(post)}
        />
      ))
    }

    <nav class="pagination">
      <p>Seite {page.currentPage} von {page.lastPage}</p>
      <ul>
        {
          page.url.prev && (
            <li>
              <Button variant="primary" href={page.url.prev}>
                Zurück
              </Button>
            </li>
          )
        }
        {
          page.url.next && (
            <li>
              <Button variant="primary" href={page.url.next}>
                Weiter
              </Button>
            </li>
          )
        }
      </ul>
    </nav>
  </main>
</PageLayout>

<style>
  .pagination {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    column-gap: 1.5rem;
  }

  .pagination ul {
    list-style-type: none;
    padding-left: unset;
    margin-top: unset;
    display: flex;
    column-gap: 0.5rem;
  }
</style>
